<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>WinMerge File Compare Report</title>
<style type="text/css">
<!--
table {margin: 0; border: 1px solid #a0a0a0; box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.15);}
td,th {word-break: break-all; font-size: 12pt;padding: 0 3px;}
tr { vertical-align: top; }
.title {color: white; background-color: blue; vertical-align: top; padding: 4px 4px; background: linear-gradient(mediumblue, darkblue);}
.sf3b2 {color: #000000; background-color: #ffffff; }
.sf3b5 {color: #000000; background-color: #0078d7; }
.sf3b14 {color: #000000; background-color: #ffa0a0; }
.sf3b16 {color: #000000; background-color: #f1e2ad; }
.sf3b18 {color: #000000; background-color: #ffaa82; }
.sf3b19 {color: #000000; background-color: #c8816c; }
.sf6b2 {color: #ffffff; background-color: #ffffff; }
.sf6b5 {color: #ffffff; background-color: #0078d7; }
.sf6b14 {color: #ffffff; background-color: #ffa0a0; }
.sf6b16 {color: #ffffff; background-color: #f1e2ad; }
.sf6b18 {color: #ffffff; background-color: #ffaa82; }
.sf6b19 {color: #ffffff; background-color: #c8816c; }
.sf7b2 {color: #0000ff; background-color: #ffffff; font-weight: bold; }
.sf7b5 {color: #0000ff; background-color: #0078d7; font-weight: bold; }
.sf7b14 {color: #0000ff; background-color: #ffa0a0; font-weight: bold; }
.sf7b16 {color: #0000ff; background-color: #f1e2ad; font-weight: bold; }
.sf7b18 {color: #0000ff; background-color: #ffaa82; font-weight: bold; }
.sf7b19 {color: #0000ff; background-color: #c8816c; font-weight: bold; }
.sf8b2 {color: #800080; background-color: #ffffff; }
.sf8b5 {color: #800080; background-color: #0078d7; }
.sf8b14 {color: #800080; background-color: #ffa0a0; }
.sf8b16 {color: #800080; background-color: #f1e2ad; }
.sf8b18 {color: #800080; background-color: #ffaa82; }
.sf8b19 {color: #800080; background-color: #c8816c; }
.sf9b2 {color: #008000; background-color: #ffffff; }
.sf9b5 {color: #008000; background-color: #0078d7; }
.sf9b14 {color: #008000; background-color: #ffa0a0; }
.sf9b16 {color: #008000; background-color: #f1e2ad; }
.sf9b18 {color: #008000; background-color: #ffaa82; }
.sf9b19 {color: #008000; background-color: #c8816c; }
.sf10b2 {color: #ff0000; background-color: #ffffff; }
.sf10b5 {color: #ff0000; background-color: #0078d7; }
.sf10b14 {color: #ff0000; background-color: #ffa0a0; }
.sf10b16 {color: #ff0000; background-color: #f1e2ad; }
.sf10b18 {color: #ff0000; background-color: #ffaa82; }
.sf10b19 {color: #ff0000; background-color: #c8816c; }
.sf11b2 {color: #606060; background-color: #ffffff; }
.sf11b5 {color: #606060; background-color: #0078d7; }
.sf11b14 {color: #606060; background-color: #ffa0a0; }
.sf11b16 {color: #606060; background-color: #f1e2ad; }
.sf11b18 {color: #606060; background-color: #ffaa82; }
.sf11b19 {color: #606060; background-color: #c8816c; }
.sf12b2 {color: #800000; background-color: #ffffff; }
.sf12b5 {color: #800000; background-color: #0078d7; }
.sf12b14 {color: #800000; background-color: #ffa0a0; }
.sf12b16 {color: #800000; background-color: #f1e2ad; }
.sf12b18 {color: #800000; background-color: #ffaa82; }
.sf12b19 {color: #800000; background-color: #c8816c; }
.sf13b2 {color: #0080c0; background-color: #ffffff; }
.sf13b5 {color: #0080c0; background-color: #0078d7; }
.sf13b14 {color: #0080c0; background-color: #ffa0a0; }
.sf13b16 {color: #0080c0; background-color: #f1e2ad; }
.sf13b18 {color: #0080c0; background-color: #ffaa82; }
.sf13b19 {color: #0080c0; background-color: #c8816c; }
.sf15b2 {color: #000000; background-color: #ffffff; }
.sf15b5 {color: #000000; background-color: #0078d7; }
.sf15b14 {color: #000000; background-color: #ffa0a0; }
.sf15b16 {color: #000000; background-color: #f1e2ad; }
.sf15b18 {color: #000000; background-color: #ffaa82; }
.sf15b19 {color: #000000; background-color: #c8816c; }
.sf17b2 {color: #000000; background-color: #ffffff; }
.sf17b5 {color: #000000; background-color: #0078d7; }
.sf17b14 {color: #000000; background-color: #ffa0a0; }
.sf17b16 {color: #000000; background-color: #f1e2ad; }
.sf17b18 {color: #000000; background-color: #ffaa82; }
.sf17b19 {color: #000000; background-color: #c8816c; }
.sf20b2 {color: #000080; background-color: #ffffff; }
.sf20b5 {color: #000080; background-color: #0078d7; }
.sf20b14 {color: #000080; background-color: #ffa0a0; }
.sf20b16 {color: #000080; background-color: #f1e2ad; }
.sf20b18 {color: #000080; background-color: #ffaa82; }
.sf20b19 {color: #000080; background-color: #c8816c; }
.sf21b2 {color: #0080c0; background-color: #ffffff; }
.sf21b5 {color: #0080c0; background-color: #0078d7; }
.sf21b14 {color: #0080c0; background-color: #ffa0a0; }
.sf21b16 {color: #0080c0; background-color: #f1e2ad; }
.sf21b18 {color: #0080c0; background-color: #ffaa82; }
.sf21b19 {color: #0080c0; background-color: #c8816c; }
.sf3b2i {color: #ababab; background-color: #ffffff; }
.sf3b5i {color: #005190; background-color: #0078d7; }
.sf3b14i {color: #ab6b6b; background-color: #ffa0a0; }
.sf3b16i {color: #a19774; background-color: #f1e2ad; }
.sf3b18i {color: #ab7257; background-color: #ffaa82; }
.sf3b19i {color: #865749; background-color: #c8816c; }
.sf6b2i {color: #ffffff; background-color: #ffffff; }
.sf6b5i {color: #54a4e4; background-color: #0078d7; }
.sf6b14i {color: #ffbfbf; background-color: #ffa0a0; }
.sf6b16i {color: #f5ebc8; background-color: #f1e2ad; }
.sf6b18i {color: #ffc6ab; background-color: #ffaa82; }
.sf6b19i {color: #daaa9c; background-color: #c8816c; }
.sf7b2i {color: #ababff; background-color: #ffffff; font-weight: bold; }
.sf7b5i {color: #0051e4; background-color: #0078d7; font-weight: bold; }
.sf7b14i {color: #ab6bbf; background-color: #ffa0a0; font-weight: bold; }
.sf7b16i {color: #a197c8; background-color: #f1e2ad; font-weight: bold; }
.sf7b18i {color: #ab72ab; background-color: #ffaa82; font-weight: bold; }
.sf7b19i {color: #86579c; background-color: #c8816c; font-weight: bold; }
.sf8b2i {color: #d5abd5; background-color: #ffffff; }
.sf8b5i {color: #2a51bb; background-color: #0078d7; }
.sf8b14i {color: #d56b96; background-color: #ffa0a0; }
.sf8b16i {color: #cc979f; background-color: #f1e2ad; }
.sf8b18i {color: #d57282; background-color: #ffaa82; }
.sf8b19i {color: #b15772; background-color: #c8816c; }
.sf9b2i {color: #abd5ab; background-color: #ffffff; }
.sf9b5i {color: #007a90; background-color: #0078d7; }
.sf9b14i {color: #ab966b; background-color: #ffa0a0; }
.sf9b16i {color: #a1c274; background-color: #f1e2ad; }
.sf9b18i {color: #ab9d57; background-color: #ffaa82; }
.sf9b19i {color: #868149; background-color: #c8816c; }
.sf10b2i {color: #ffabab; background-color: #ffffff; }
.sf10b5i {color: #545190; background-color: #0078d7; }
.sf10b14i {color: #ff6b6b; background-color: #ffa0a0; }
.sf10b16i {color: #f59774; background-color: #f1e2ad; }
.sf10b18i {color: #ff7257; background-color: #ffaa82; }
.sf10b19i {color: #da5749; background-color: #c8816c; }
.sf11b2i {color: #cbcbcb; background-color: #ffffff; }
.sf11b5i {color: #1f71b0; background-color: #0078d7; }
.sf11b14i {color: #cb8b8b; background-color: #ffa0a0; }
.sf11b16i {color: #c1b794; background-color: #f1e2ad; }
.sf11b18i {color: #cb9277; background-color: #ffaa82; }
.sf11b19i {color: #a67769; background-color: #c8816c; }
.sf12b2i {color: #d5abab; background-color: #ffffff; }
.sf12b5i {color: #2a5190; background-color: #0078d7; }
.sf12b14i {color: #d56b6b; background-color: #ffa0a0; }
.sf12b16i {color: #cc9774; background-color: #f1e2ad; }
.sf12b18i {color: #d57257; background-color: #ffaa82; }
.sf12b19i {color: #b15749; background-color: #c8816c; }
.sf13b2i {color: #abd5eb; background-color: #ffffff; }
.sf13b5i {color: #007ad0; background-color: #0078d7; }
.sf13b14i {color: #ab96aa; background-color: #ffa0a0; }
.sf13b16i {color: #a1c2b3; background-color: #f1e2ad; }
.sf13b18i {color: #ab9d96; background-color: #ffaa82; }
.sf13b19i {color: #868187; background-color: #c8816c; }
.sf15b2i {color: #ababab; background-color: #ffffff; }
.sf15b5i {color: #005190; background-color: #0078d7; }
.sf15b14i {color: #ab6b6b; background-color: #ffa0a0; }
.sf15b16i {color: #a19774; background-color: #f1e2ad; }
.sf15b18i {color: #ab7257; background-color: #ffaa82; }
.sf15b19i {color: #865749; background-color: #c8816c; }
.sf17b2i {color: #ababab; background-color: #ffffff; }
.sf17b5i {color: #005190; background-color: #0078d7; }
.sf17b14i {color: #ab6b6b; background-color: #ffa0a0; }
.sf17b16i {color: #a19774; background-color: #f1e2ad; }
.sf17b18i {color: #ab7257; background-color: #ffaa82; }
.sf17b19i {color: #865749; background-color: #c8816c; }
.sf20b2i {color: #ababd5; background-color: #ffffff; }
.sf20b5i {color: #0051bb; background-color: #0078d7; }
.sf20b14i {color: #ab6b96; background-color: #ffa0a0; }
.sf20b16i {color: #a1979f; background-color: #f1e2ad; }
.sf20b18i {color: #ab7282; background-color: #ffaa82; }
.sf20b19i {color: #865772; background-color: #c8816c; }
.sf21b2i {color: #abd5eb; background-color: #ffffff; }
.sf21b5i {color: #007ad0; background-color: #0078d7; }
.sf21b14i {color: #ab96aa; background-color: #ffa0a0; }
.sf21b16i {color: #a1c2b3; background-color: #f1e2ad; }
.sf21b18i {color: #ab9d96; background-color: #ffaa82; }
.sf21b19i {color: #868187; background-color: #c8816c; }
.ln {text-align: right; word-break: normal; color: #000000; background-color: #f0f0f0;}
-->
</style>
</head>
<body>
<table cellspacing="0" cellpadding="0" style="width:100%;">
<colgroup>
<col style="width: 2.5em;" />
<col style="width: calc(100vw / 2 - 2.5em);" />
<col style="width: 2.5em;" />
<col style="width: calc(100vw / 2 - 2.5em);" />
</colgroup>
<thead>
<tr>
<th colspan="2" class="title">C:\msys64\home\nelco\nginx-release-1.26.0\src\http\modules\ngx_http_upstream_ip_hash_module.c</th>
<th colspan="2" class="title">C:\msys64\home\nelco\Nginx_1.26.0\src\http\modules\ngx_http_upstream_ip_hash_module.c</th>
</tr>
</thead>
<tbody>
<tr>
<td class="ln">1</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">1</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
<td class="ln">2</td><td class="sf3b2"><code><span class="sf9b2">/*</span></code></td>
</tr>
<tr>
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2">&nbsp;* Copyright (C) Igor Sysoev</span></code></td>
<td class="ln">3</td><td class="sf3b2"><code><span class="sf9b2">&nbsp;* Copyright (C) Igor Sysoev</span></code></td>
</tr>
<tr>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2">&nbsp;* Copyright (C) Nginx, Inc.</span></code></td>
<td class="ln">4</td><td class="sf3b2"><code><span class="sf9b2">&nbsp;* Copyright (C) Nginx, Inc.</span></code></td>
</tr>
<tr>
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2">&nbsp;*/</span>&nbsp;</code></td>
<td class="ln">5</td><td class="sf3b2"><code><span class="sf9b2">&nbsp;*/</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">6</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">6</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">7</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">7</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">8</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;ngx_config.h&gt;</span></code></td>
<td class="ln">8</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;ngx_config.h&gt;</span></code></td>
</tr>
<tr>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;ngx_core.h&gt;</span></code></td>
<td class="ln">9</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;ngx_core.h&gt;</span></code></td>
</tr>
<tr>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;ngx_http.h&gt;</span></code></td>
<td class="ln">10</td><td class="sf3b2"><code><span class="sf13b2">#include &lt;ngx_http.h&gt;</span></code></td>
</tr>
<tr>
<td class="ln">11</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">11</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">12</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">12</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">13</td><td class="sf3b2"><code><span class="sf7b2">typedef</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;{</span></code></td>
<td class="ln">13</td><td class="sf3b2"><code><span class="sf7b2">typedef</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;{</span></code></td>
</tr>
<tr>
<td class="ln">14</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf9b2">/* the round robin data must be first */</span>&nbsp;</code></td>
<td class="ln">14</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf9b2">/* the round robin data must be first */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">15</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_rr_peer_data_t</span><span class="sf11b2">&nbsp; &nbsp;</span><span class="sf3b2">rrp</span><span class="sf11b2">;</span></code></td>
<td class="ln">15</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_rr_peer_data_t</span><span class="sf11b2">&nbsp; &nbsp;</span><span class="sf3b2">rrp</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">16</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">16</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">17</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_uint_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
<td class="ln">17</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_uint_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">18</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">18</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">addrlen</span><span class="sf11b2">;</span></code></td>
<td class="ln">19</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">addrlen</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="sf3b2">addr</span><span class="sf11b2">;</span></code></td>
<td class="ln">20</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="sf3b2">addr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">21</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">21</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">tries</span><span class="sf11b2">;</span></code></td>
<td class="ln">22</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">tries</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">23</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">23</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">24</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_event_get_peer_pt</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">get_rr_peer</span><span class="sf11b2">;</span></code></td>
<td class="ln">24</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_event_get_peer_pt</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">get_rr_peer</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf11b2">} </span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_data_t</span><span class="sf11b2">;</span></code></td>
<td class="ln">25</td><td class="sf3b2"><code><span class="sf11b2">} </span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_data_t</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">26</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">26</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">27</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">ngx_http_upstream_init_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx<wbr>_http_request_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">r</span><span class="sf11b2">,</span></code></td>
<td class="ln">28</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">ngx_http_upstream_init_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx<wbr>_http_request_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">r</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">us</span><span class="sf11b2">);</span></code></td>
<td class="ln">29</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">us</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">ngx_http_upstream_get_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx_<wbr>peer_connection_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">pc</span><span class="sf11b2">,</span></code></td>
<td class="ln">30</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span><span class="sf11b2">&nbsp;</span><span class="sf8b2">ngx_http_upstream_get_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx_<wbr>peer_connection_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">pc</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">data</span><span class="sf11b2">);</span></code></td>
<td class="ln">31</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">data</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">char</span><span class="sf11b2">&nbsp;*</span><span class="sf8b2">ngx_http_upstream_ip_hash</span><span class="sf11b2">(</span><span class="sf3b2">ngx_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_command_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cmd</span><span class="sf11b2">,</span></code></td>
<td class="ln">32</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">char</span><span class="sf11b2">&nbsp;*</span><span class="sf8b2">ngx_http_upstream_ip_hash</span><span class="sf11b2">(</span><span class="sf3b2">ngx_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_command_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cmd</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">conf</span><span class="sf11b2">);</span></code></td>
<td class="ln">33</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">conf</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">34</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">34</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">35</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">35</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">36</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_command_t</span><span class="sf11b2">&nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_commands</span><span class="sf11b2">[] = {</span></code></td>
<td class="ln">36</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_command_t</span><span class="sf11b2">&nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_commands</span><span class="sf11b2">[] = {</span></code></td>
</tr>
<tr>
<td class="ln">37</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">37</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; { </span><span class="sf8b2">ngx_string</span><span class="sf11b2">(</span><span class="sf12b2">"ip_hash"</span><span class="sf11b2">),</span></code></td>
<td class="ln">38</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; { </span><span class="sf8b2">ngx_string</span><span class="sf11b2">(</span><span class="sf12b2">"ip_hash"</span><span class="sf11b2">),</span></code></td>
</tr>
<tr>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">NGX_HTTP_UPS_CONF</span><span class="sf11b2">|</span><span class="sf3b2">NGX_CONF_NOARGS</span><span class="sf11b2">,</span></code></td>
<td class="ln">39</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">NGX_HTTP_UPS_CONF</span><span class="sf11b2">|</span><span class="sf3b2">NGX_CONF_NOARGS</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">40</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash</span><span class="sf11b2">,</span></code></td>
<td class="ln">40</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">41</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
<td class="ln">41</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">42</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
<td class="ln">42</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">&nbsp;},</span></code></td>
<td class="ln">43</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">&nbsp;},</span></code></td>
</tr>
<tr>
<td class="ln">44</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">44</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">ngx_null_command</span></code></td>
<td class="ln">45</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; </span><span class="sf3b2">ngx_null_command</span></code></td>
</tr>
<tr>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf11b2">};</span></code></td>
<td class="ln">46</td><td class="sf3b2"><code><span class="sf11b2">};</span></code></td>
</tr>
<tr>
<td class="ln">47</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">47</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">48</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">48</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_http_module_t</span><span class="sf11b2">&nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_module_ctx</span><span class="sf11b2">&nbsp;= {</span></code></td>
<td class="ln">49</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_http_module_t</span><span class="sf11b2">&nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_module_ctx</span><span class="sf11b2">&nbsp;= {</span></code></td>
</tr>
<tr>
<td class="ln">50</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* preconfiguration */</span>&nbsp;</code></td>
<td class="ln">50</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* preconfiguration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* postconfiguration */</span>&nbsp;</code></td>
<td class="ln">51</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* postconfiguration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">52</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">52</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* create main configuration */</span>&nbsp;</code></td>
<td class="ln">53</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* create main configuration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">54</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init main configuration */</span>&nbsp;</code></td>
<td class="ln">54</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init main configuration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">55</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">55</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* create server configuration */</span>&nbsp;</code></td>
<td class="ln">56</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* create server configuration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* merge server configuration */</span>&nbsp;</code></td>
<td class="ln">57</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* merge server configuration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">58</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">58</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">59</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* create location configuration */</span>&nbsp;</code></td>
<td class="ln">59</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* create location configuration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">60</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* merge location configuration */</span>&nbsp;</code></td>
<td class="ln">60</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* merge location configuration */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">61</td><td class="sf3b2"><code><span class="sf11b2">};</span></code></td>
<td class="ln">61</td><td class="sf3b2"><code><span class="sf11b2">};</span></code></td>
</tr>
<tr>
<td class="ln">62</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">62</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">63</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">63</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf3b2">ngx_module_t</span><span class="sf11b2">&nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_module</span><span class="sf11b2">&nbsp;= {</span></code></td>
<td class="ln">64</td><td class="sf3b2"><code><span class="sf3b2">ngx_module_t</span><span class="sf11b2">&nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_module</span><span class="sf11b2">&nbsp;= {</span></code></td>
</tr>
<tr>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NGX_MODULE_V1</span><span class="sf11b2">,</span></code></td>
<td class="ln">65</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NGX_MODULE_V1</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">66</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &amp;</span><span class="sf3b2">ngx_http_upstream_ip_hash_module_ctx</span><span class="sf11b2">, </span><span class="sf9b2">/* module context */</span>&nbsp;</code></td>
<td class="ln">66</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &amp;</span><span class="sf3b2">ngx_http_upstream_ip_hash_module_ctx</span><span class="sf11b2">, </span><span class="sf9b2">/* module context */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_commands</span><span class="sf11b2">, &nbsp; &nbsp;</span><span class="sf9b2">/* module directives */</span>&nbsp;</code></td>
<td class="ln">67</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_commands</span><span class="sf11b2">, &nbsp; &nbsp;</span><span class="sf9b2">/* module directives */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">68</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NGX_HTTP_MODULE</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2">/* module type */</span>&nbsp;</code></td>
<td class="ln">68</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NGX_HTTP_MODULE</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf9b2">/* module type */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">69</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init master */</span>&nbsp;</code></td>
<td class="ln">69</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init master */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">70</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init module */</span>&nbsp;</code></td>
<td class="ln">70</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init module */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">71</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init process */</span>&nbsp;</code></td>
<td class="ln">71</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init process */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">72</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init thread */</span>&nbsp;</code></td>
<td class="ln">72</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* init thread */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">73</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* exit thread */</span>&nbsp;</code></td>
<td class="ln">73</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* exit thread */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">74</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* exit process */</span>&nbsp;</code></td>
<td class="ln">74</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* exit process */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">75</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* exit master */</span>&nbsp;</code></td>
<td class="ln">75</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NULL</span><span class="sf11b2">, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf9b2">/* exit master */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">76</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NGX_MODULE_V1_PADDING</span></code></td>
<td class="ln">76</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">NGX_MODULE_V1_PADDING</span></code></td>
</tr>
<tr>
<td class="ln">77</td><td class="sf3b2"><code><span class="sf11b2">};</span></code></td>
<td class="ln">77</td><td class="sf3b2"><code><span class="sf11b2">};</span></code></td>
</tr>
<tr>
<td class="ln">78</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">78</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">79</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">79</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">80</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_http_upstream_ip_hash_pseudo_addr</span><span class="sf11b2">[</span><span class="sf10b2">3<wbr></span><span class="sf11b2">];</span></code></td>
<td class="ln">80</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_http_upstream_ip_hash_pseudo_addr</span><span class="sf11b2">[</span><span class="sf10b2">3<wbr></span><span class="sf11b2">];</span></code></td>
</tr>
<tr>
<td class="ln">81</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">81</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">82</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">82</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span></code></td>
<td class="ln">83</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span></code></td>
</tr>
<tr>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_init_ip_hash</span><span class="sf11b2">(</span><span class="sf3b2">ngx_conf<wbr>_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">us</span><span class="sf11b2">)</span></code></td>
<td class="ln">84</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_init_ip_hash</span><span class="sf11b2">(</span><span class="sf3b2">ngx_conf<wbr>_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">us</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">85</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">85</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf8b2">ngx_http_upstream_init_round_robin</span><span class="sf11b2">(</span><span class="sf3b2">cf</span><span class="sf11b2">,<wbr> </span><span class="sf3b2">us</span><span class="sf11b2">) != </span><span class="sf3b2">NGX_OK</span><span class="sf11b2">) {</span></code></td>
<td class="ln">86</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf8b2">ngx_http_upstream_init_round_robin</span><span class="sf11b2">(</span><span class="sf3b2">cf</span><span class="sf11b2">,<wbr> </span><span class="sf3b2">us</span><span class="sf11b2">) != </span><span class="sf3b2">NGX_OK</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">87</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_ERROR</span><span class="sf11b2">;</span></code></td>
<td class="ln">87</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_ERROR</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">88</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">88</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">89</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">89</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">90</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">us</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">init</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_init_ip_hash_peer</span><span class="sf11b2">;</span></code></td>
<td class="ln">90</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">us</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">init</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_init_ip_hash_peer</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">91</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">91</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">92</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_OK</span><span class="sf11b2">;</span></code></td>
<td class="ln">92</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_OK</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">93</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">93</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">94</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">94</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">95</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">95</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">96</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span></code></td>
<td class="ln">96</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span></code></td>
</tr>
<tr>
<td class="ln">97</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_init_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx<wbr>_http_request_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">r</span><span class="sf11b2">,</span></code></td>
<td class="ln">97</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_init_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx<wbr>_http_request_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">r</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">98</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">us</span><span class="sf11b2">)</span></code></td>
<td class="ln">98</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">us</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">99</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">99</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">100</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</span><span class="sf3b2">sin</span><span class="sf11b2">;</span></code></td>
<td class="ln">100</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*</span><span class="sf3b2">sin</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">101</td><td class="sf3b2"><code><span class="sf13b2">#if (NGX_HAVE_INET6)</span></code></td>
<td class="ln">101</td><td class="sf3b2"><code><span class="sf13b2">#if (NGX_HAVE_INET6)</span></code></td>
</tr>
<tr>
<td class="ln">102</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in6</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="sf3b2">sin6</span><span class="sf11b2">;</span></code></td>
<td class="ln">102</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in6</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *</span><span class="sf3b2">sin6</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf13b2">#endif</span></code></td>
<td class="ln">103</td><td class="sf3b2"><code><span class="sf13b2">#endif</span></code></td>
</tr>
<tr>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_data_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">iphp</span><span class="sf11b2">;</span></code></td>
<td class="ln">104</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_data_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">iphp</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">105</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">105</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">106</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">ngx_palloc</span><span class="sf11b2">(</span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">pool</span><span class="sf11b2">, </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_d<wbr>ata_t</span><span class="sf11b2">));</span></code></td>
<td class="ln">106</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">ngx_palloc</span><span class="sf11b2">(</span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">pool</span><span class="sf11b2">, </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_d<wbr>ata_t</span><span class="sf11b2">));</span></code></td>
</tr>
<tr>
<td class="ln">107</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">iphp</span><span class="sf11b2">&nbsp;== </span><span class="sf3b2">NULL</span><span class="sf11b2">) {</span></code></td>
<td class="ln">107</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">iphp</span><span class="sf11b2">&nbsp;== </span><span class="sf3b2">NULL</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">108</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_ERROR</span><span class="sf11b2">;</span></code></td>
<td class="ln">108</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_ERROR</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">109</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">109</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">110</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">110</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">111</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">upstream</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">&nbsp;= &amp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">;</span></code></td>
<td class="ln">111</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">upstream</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">data</span><span class="sf11b2">&nbsp;= &amp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">112</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">112</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf8b2">ngx_http_upstream_init_round_robin_pee<wbr>r</span><span class="sf11b2">(</span><span class="sf3b2">r</span><span class="sf11b2">, </span><span class="sf3b2">us</span><span class="sf11b2">) != </span><span class="sf3b2">NGX_OK</span><span class="sf11b2">) {</span></code></td>
<td class="ln">113</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf8b2">ngx_http_upstream_init_round_robin_pee<wbr>r</span><span class="sf11b2">(</span><span class="sf3b2">r</span><span class="sf11b2">, </span><span class="sf3b2">us</span><span class="sf11b2">) != </span><span class="sf3b2">NGX_OK</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">114</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_ERROR</span><span class="sf11b2">;</span></code></td>
<td class="ln">114</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_ERROR</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">115</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">115</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">116</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">116</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">117</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">upstream</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">get</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_get_ip_hash_peer</span><span class="sf11b2">;</span></code></td>
<td class="ln">117</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">upstream</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">get</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_get_ip_hash_peer</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">118</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">118</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">119</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">switch</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sa_family</span><span class="sf11b2">) {</span></code></td>
<td class="ln">119</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">switch</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sa_family</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">120</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">120</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">121</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">case</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">AF_INET</span><span class="sf11b2">:</span></code></td>
<td class="ln">121</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">case</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">AF_INET</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln">122</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">sin</span><span class="sf11b2">&nbsp;= (</span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in</span><span class="sf11b2">&nbsp;*) </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">;</span></code></td>
<td class="ln">122</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">sin</span><span class="sf11b2">&nbsp;= (</span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in</span><span class="sf11b2">&nbsp;*) </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">123</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp;*) &amp;</span><span class="sf3b2">sin</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sin_addr</span><span class="sf11b2">.</span><span class="sf3b2">s_addr</span><span class="sf11b2">;</span></code></td>
<td class="ln">123</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp;*) &amp;</span><span class="sf3b2">sin</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sin_addr</span><span class="sf11b2">.</span><span class="sf3b2">s_addr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d1" href="#d1">124</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">iphp</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">addrlen</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span class="sf17b16">3</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">124</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">iphp</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">addrlen</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span class="sf17b16">4</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">125</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">break</span><span class="sf11b2">;</span></code></td>
<td class="ln">125</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">break</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">126</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">126</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">127</td><td class="sf3b2"><code><span class="sf13b2">#if (NGX_HAVE_INET6)</span></code></td>
<td class="ln">127</td><td class="sf3b2"><code><span class="sf13b2">#if (NGX_HAVE_INET6)</span></code></td>
</tr>
<tr>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">case</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">AF_INET6</span><span class="sf11b2">:</span></code></td>
<td class="ln">128</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">case</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">AF_INET6</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln">129</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">sin6</span><span class="sf11b2">&nbsp;= (</span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in6</span><span class="sf11b2">&nbsp;*) </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">;</span></code></td>
<td class="ln">129</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">sin6</span><span class="sf11b2">&nbsp;= (</span><span class="sf7b2">struct</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">sockaddr_in6</span><span class="sf11b2">&nbsp;*) </span><span class="sf3b2">r</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">130</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp;*) &amp;</span><span class="sf3b2">sin6</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sin6_addr</span><span class="sf11b2">.</span><span class="sf3b2">s6_addr</span><span class="sf11b2">;</span></code></td>
<td class="ln">130</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">u_char</span><span class="sf11b2">&nbsp;*) &amp;</span><span class="sf3b2">sin6</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sin6_addr</span><span class="sf11b2">.</span><span class="sf3b2">s6_addr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">131</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addrlen</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">16</span><span class="sf11b2">;</span></code></td>
<td class="ln">131</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addrlen</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">16</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">132</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">break</span><span class="sf11b2">;</span></code></td>
<td class="ln">132</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">break</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">133</td><td class="sf3b2"><code><span class="sf13b2">#endif</span></code></td>
<td class="ln">133</td><td class="sf3b2"><code><span class="sf13b2">#endif</span></code></td>
</tr>
<tr>
<td class="ln">134</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">134</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">135</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">default</span><span class="sf11b2">:</span></code></td>
<td class="ln">135</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">default</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_ip_hash_pseudo_addr</span><span class="sf11b2">;</span></code></td>
<td class="ln">136</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_ip_hash_pseudo_addr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln"><a name="d2" href="#d2">137</a></td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">iphp</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">addrlen</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span class="sf17b16">3</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
<td class="ln">137</td><td style="color: #000000; background-color: #efcb05; "><code><span style="color: #000000; background-color: #efcb05; ">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #000000; background-color: #efcb05; ">iphp</span><span style="color: #000000; background-color: #efcb05; ">-&gt;</span><span style="color: #000000; background-color: #efcb05; ">addrlen</span><span style="color: #000000; background-color: #efcb05; ">&nbsp;= </span><span class="sf17b16">4</span><span style="color: #000000; background-color: #efcb05; ">;</span></code></td>
</tr>
<tr>
<td class="ln">138</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">138</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">139</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">139</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">140</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">89</span><span class="sf11b2">;</span></code></td>
<td class="ln">140</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">89</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">141</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
<td class="ln">141</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">get_rr_peer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_get_round_robin_peer</span><span class="sf11b2">;<wbr></span></code></td>
<td class="ln">142</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">get_rr_peer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_get_round_robin_peer</span><span class="sf11b2">;<wbr></span></code></td>
</tr>
<tr>
<td class="ln">143</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">143</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_OK</span><span class="sf11b2">;</span></code></td>
<td class="ln">144</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_OK</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">145</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">145</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">146</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">146</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">147</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">147</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">148</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span></code></td>
<td class="ln">148</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">ngx_int_t</span></code></td>
</tr>
<tr>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_get_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx_<wbr>peer_connection_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">pc</span><span class="sf11b2">, </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">data</span><span class="sf11b2">)</span></code></td>
<td class="ln">149</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_get_ip_hash_peer</span><span class="sf11b2">(</span><span class="sf3b2">ngx_<wbr>peer_connection_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">pc</span><span class="sf11b2">, </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">data</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">150</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">151</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_data_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">iphp</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
<td class="ln">151</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_ip_hash_peer_data_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">iphp</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">data</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">152</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">152</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">time_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">now</span><span class="sf11b2">;</span></code></td>
<td class="ln">153</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">time_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">now</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">154</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_int_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">w</span><span class="sf11b2">;</span></code></td>
<td class="ln">154</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_int_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">w</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">155</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uintptr_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">m</span><span class="sf11b2">;</span></code></td>
<td class="ln">155</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uintptr_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf3b2">m</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">156</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_uint_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">i</span><span class="sf11b2">, </span><span class="sf3b2">n</span><span class="sf11b2">, </span><span class="sf3b2">p</span><span class="sf11b2">, </span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
<td class="ln">156</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_uint_t</span><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">i</span><span class="sf11b2">, </span><span class="sf3b2">n</span><span class="sf11b2">, </span><span class="sf3b2">p</span><span class="sf11b2">, </span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">157</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_rr_peer_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">peer</span><span class="sf11b2">;</span></code></td>
<td class="ln">157</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_rr_peer_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">peer</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">158</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">158</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">159</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_log_debug1</span><span class="sf11b2">(</span><span class="sf3b2">NGX_LOG_DEBUG_HTTP</span><span class="sf11b2">, </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">log</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
<td class="ln">159</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_log_debug1</span><span class="sf11b2">(</span><span class="sf3b2">NGX_LOG_DEBUG_HTTP</span><span class="sf11b2">, </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">log</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">160</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"get ip hash peer, try: %ui"</span><span class="sf11b2">, </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">);</span></code></td>
<td class="ln">160</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"get ip hash peer, try: %ui"</span><span class="sf11b2">, </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">161</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">161</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">162</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf9b2">/* TODO: cached */</span>&nbsp;</code></td>
<td class="ln">162</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf9b2">/* TODO: cached */</span>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">163</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">163</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">164</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_rlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
<td class="ln">164</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_rlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">165</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">165</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf10b2">20</span><span class="sf11b2">&nbsp;|| </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">single</span><span class="sf11b2">) {</span></code></td>
<td class="ln">166</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf10b2">20</span><span class="sf11b2">&nbsp;|| </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">single</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">167</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-<wbr>&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
<td class="ln">167</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-<wbr>&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf8b2">get_rr_peer</span><span class="sf11b2">(</span><span class="sf3b2">pc</span><span class="sf11b2">, &amp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">);</span></code></td>
<td class="ln">168</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf8b2">get_rr_peer</span><span class="sf11b2">(</span><span class="sf3b2">pc</span><span class="sf11b2">, &amp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">169</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">170</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">170</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">171</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">now</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">ngx_time</span><span class="sf11b2">();</span></code></td>
<td class="ln">171</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">now</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">ngx_time</span><span class="sf11b2">();</span></code></td>
</tr>
<tr>
<td class="ln">172</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">172</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">173</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">cached</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
<td class="ln">173</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">cached</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">NULL</span><span class="sf11b2">;</span></code></td>
<td class="ln">174</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">connection</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">NULL</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">175</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">175</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">176</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
<td class="ln">176</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">177</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">177</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">178</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;( ;; ) {</span></code></td>
<td class="ln">178</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;( ;; ) {</span></code></td>
</tr>
<tr>
<td class="ln">179</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">179</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;&lt; (</span><span class="sf3b2">ngx_uint_t</span><span class="sf11b2">) </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addrlen</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">++) {</span></code></td>
<td class="ln">180</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">for</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">&nbsp;&lt; (</span><span class="sf3b2">ngx_uint_t</span><span class="sf11b2">) </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addrlen</span><span class="sf11b2">; </span><span class="sf3b2">i</span><span class="sf11b2">++) {</span></code></td>
</tr>
<tr>
<td class="ln">181</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;* </span><span class="sf10b2">113</span><span class="sf11b2">&nbsp;+ </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">]) % </span><span class="sf10b2">6271</span><span class="sf11b2">;</span></code></td>
<td class="ln">181</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;* </span><span class="sf10b2">113</span><span class="sf11b2">&nbsp;+ </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">addr</span><span class="sf11b2">[</span><span class="sf3b2">i</span><span class="sf11b2">]) % </span><span class="sf10b2">6271</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">182</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">182</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">183</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">183</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">w</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;% </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">total_weight</span><span class="sf11b2">;</span></code></td>
<td class="ln">184</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">w</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;% </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">total_weight</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">;</span></code></td>
<td class="ln">185</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
<td class="ln">186</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;= </span><span class="sf10b2">0</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">187</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">187</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">while</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">w</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">weight</span><span class="sf11b2">) {</span></code></td>
<td class="ln">188</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">while</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">w</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">weight</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">189</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">w</span><span class="sf11b2">&nbsp;-= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">weight</span><span class="sf11b2">;</span></code></td>
<td class="ln">189</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">w</span><span class="sf11b2">&nbsp;-= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">weight</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">190</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
<td class="ln">190</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">191</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">p</span><span class="sf11b2">++;</span></code></td>
<td class="ln">191</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">p</span><span class="sf11b2">++;</span></code></td>
</tr>
<tr>
<td class="ln">192</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">192</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">193</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">193</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">194</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">n</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;/ (</span><span class="sf10b2">8</span><span class="sf11b2">&nbsp;* </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">uintptr_t</span><span class="sf11b2">));</span></code></td>
<td class="ln">194</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">n</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;/ (</span><span class="sf10b2">8</span><span class="sf11b2">&nbsp;* </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">uintptr_t</span><span class="sf11b2">));</span></code></td>
</tr>
<tr>
<td class="ln">195</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">m</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">uintptr_t</span><span class="sf11b2">) </span><span class="sf10b2">1</span><span class="sf11b2">&nbsp;&lt;&lt; </span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;% (</span><span class="sf10b2">8</span><span class="sf11b2">&nbsp;* </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">uintptr_t</span><span class="sf11b2">));</span></code></td>
<td class="ln">195</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">m</span><span class="sf11b2">&nbsp;= (</span><span class="sf3b2">uintptr_t</span><span class="sf11b2">) </span><span class="sf10b2">1</span><span class="sf11b2">&nbsp;&lt;&lt; </span><span class="sf3b2">p</span><span class="sf11b2">&nbsp;% (</span><span class="sf10b2">8</span><span class="sf11b2">&nbsp;* </span><span class="sf7b2">sizeof</span><span class="sf11b2">(</span><span class="sf3b2">uintptr_t</span><span class="sf11b2">));</span></code></td>
</tr>
<tr>
<td class="ln">196</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">196</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">tried</span><span class="sf11b2">[</span><span class="sf3b2">n</span><span class="sf11b2">] &amp; </span><span class="sf3b2">m</span><span class="sf11b2">) {</span></code></td>
<td class="ln">197</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">tried</span><span class="sf11b2">[</span><span class="sf3b2">n</span><span class="sf11b2">] &amp; </span><span class="sf3b2">m</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
<td class="ln">198</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">199</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">199</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">200</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">200</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">201</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_log_debug2</span><span class="sf11b2">(</span><span class="sf3b2">NGX_LOG_DEBUG_HTTP</span><span class="sf11b2">, </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">log</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
<td class="ln">201</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_log_debug2</span><span class="sf11b2">(</span><span class="sf3b2">NGX_LOG_DEBUG_HTTP</span><span class="sf11b2">, </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">log</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">202</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"get ip hash peer, hash: %ui %04XL"</span><span class="sf11b2">, </span><span class="sf3b2">p</span><span class="sf11b2">, (</span><span class="sf3b2">uint64_t</span><span class="sf11b2">) </span><span class="sf3b2">m</span><span class="sf11b2">);</span></code></td>
<td class="ln">202</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"get ip hash peer, hash: %ui %04XL"</span><span class="sf11b2">, </span><span class="sf3b2">p</span><span class="sf11b2">, (</span><span class="sf3b2">uint64_t</span><span class="sf11b2">) </span><span class="sf3b2">m</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">203</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">203</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_lock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rr<wbr>p</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
<td class="ln">204</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_lock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rr<wbr>p</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">205</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">205</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">down</span><span class="sf11b2">) {</span></code></td>
<td class="ln">206</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">down</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
<td class="ln">207</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">208</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
<td class="ln">208</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">209</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">209</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">210</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">210</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_fails</span></code></td>
<td class="ln">211</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_fails</span></code></td>
</tr>
<tr>
<td class="ln">212</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">fails</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_fails</span></code></td>
<td class="ln">212</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">fails</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_fails</span></code></td>
</tr>
<tr>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; </span><span class="sf3b2">now</span><span class="sf11b2">&nbsp;- </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">checked</span><span class="sf11b2">&nbsp;&lt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">fail_timeout</span><span class="sf11b2">)</span></code></td>
<td class="ln">213</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; </span><span class="sf3b2">now</span><span class="sf11b2">&nbsp;- </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">checked</span><span class="sf11b2">&nbsp;&lt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">fail_timeout</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">214</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></code></td>
<td class="ln">214</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></code></td>
</tr>
<tr>
<td class="ln">215</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
<td class="ln">215</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
<td class="ln">216</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">217</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">217</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">218</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">218</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_conns</span><span class="sf11b2">&nbsp;&amp;&amp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">conns</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_conns</span><span class="sf11b2">) {</span></code></td>
<td class="ln">219</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_conns</span><span class="sf11b2">&nbsp;&amp;&amp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">conns</span><span class="sf11b2">&nbsp;&gt;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">max_conns</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
<td class="ln">220</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">221</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
<td class="ln">221</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">goto</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">next</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">222</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">223</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">223</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">224</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">break</span><span class="sf11b2">;</span></code></td>
<td class="ln">224</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">break</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">225</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">225</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">next</span><span class="sf11b2">:</span></code></td>
<td class="ln">226</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">next</span><span class="sf11b2">:</span></code></td>
</tr>
<tr>
<td class="ln">227</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">227</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(++</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf10b2">20</span><span class="sf11b2">) {</span></code></td>
<td class="ln">228</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(++</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">tries</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf10b2">20</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-<wbr>&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
<td class="ln">229</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-<wbr>&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">230</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf8b2">get_rr_peer</span><span class="sf11b2">(</span><span class="sf3b2">pc</span><span class="sf11b2">, &amp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">);</span></code></td>
<td class="ln">230</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf8b2">get_rr_peer</span><span class="sf11b2">(</span><span class="sf3b2">pc</span><span class="sf11b2">, &amp;</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
<td class="ln">231</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">232</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">233</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">233</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">234</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">current</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">;</span></code></td>
<td class="ln">234</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">current</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">235</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">235</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">;</span></code></td>
<td class="ln">236</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">sockaddr</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">socklen</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">socklen</span><span class="sf11b2">;</span></code></td>
<td class="ln">237</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">socklen</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">socklen</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">238</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">name</span><span class="sf11b2">&nbsp;= &amp;</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">name</span><span class="sf11b2">;</span></code></td>
<td class="ln">238</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">pc</span><span class="sf11b2">-&gt;</span><span class="sf3b2">name</span><span class="sf11b2">&nbsp;= &amp;</span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">name</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">239</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">239</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">240</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">conns</span><span class="sf11b2">++;</span></code></td>
<td class="ln">240</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">conns</span><span class="sf11b2">++;</span></code></td>
</tr>
<tr>
<td class="ln">241</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">241</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">242</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">now</span><span class="sf11b2">&nbsp;- </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">checked</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">fail_timeout</span><span class="sf11b2">) {</span></code></td>
<td class="ln">242</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">now</span><span class="sf11b2">&nbsp;- </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">checked</span><span class="sf11b2">&nbsp;&gt; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">fail_timeout</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">243</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">checked</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">now</span><span class="sf11b2">;</span></code></td>
<td class="ln">243</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf3b2">peer</span><span class="sf11b2">-&gt;</span><span class="sf3b2">checked</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">now</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">244</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">244</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">245</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">245</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">246</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
<td class="ln">246</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peer_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;<wbr></span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">, </span><span class="sf3b2">peer</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">247</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-<wbr>&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
<td class="ln">247</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf8b2">ngx_http_upstream_rr_peers_unlock</span><span class="sf11b2">(</span><span class="sf3b2">iphp</span><span class="sf11b2">-<wbr>&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">peers</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">248</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">248</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">249</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">tried</span><span class="sf11b2">[</span><span class="sf3b2">n</span><span class="sf11b2">] |= </span><span class="sf3b2">m</span><span class="sf11b2">;</span></code></td>
<td class="ln">249</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">rrp</span><span class="sf11b2">.</span><span class="sf3b2">tried</span><span class="sf11b2">[</span><span class="sf3b2">n</span><span class="sf11b2">] |= </span><span class="sf3b2">m</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">250</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
<td class="ln">250</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">iphp</span><span class="sf11b2">-&gt;</span><span class="sf3b2">hash</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">hash</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">251</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">251</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">252</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_OK</span><span class="sf11b2">;</span></code></td>
<td class="ln">252</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_OK</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">253</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">253</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">254</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">254</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">255</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">255</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">256</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">char</span><span class="sf11b2">&nbsp;*</span></code></td>
<td class="ln">256</td><td class="sf3b2"><code><span class="sf7b2">static</span><span class="sf11b2">&nbsp;</span><span class="sf7b2">char</span><span class="sf11b2">&nbsp;*</span></code></td>
</tr>
<tr>
<td class="ln">257</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_ip_hash</span><span class="sf11b2">(</span><span class="sf3b2">ngx_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_command_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cmd</span><span class="sf11b2">, </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">conf</span><span class="sf11b2">)</span></code></td>
<td class="ln">257</td><td class="sf3b2"><code><span class="sf8b2">ngx_http_upstream_ip_hash</span><span class="sf11b2">(</span><span class="sf3b2">ngx_conf_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_command_t</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">cmd</span><span class="sf11b2">, </span><span class="sf7b2">void</span><span class="sf11b2">&nbsp;*</span><span class="sf3b2">conf</span><span class="sf11b2">)</span></code></td>
</tr>
<tr>
<td class="ln">258</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
<td class="ln">258</td><td class="sf3b2"><code><span class="sf11b2">{</span></code></td>
</tr>
<tr>
<td class="ln">259</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">uscf</span><span class="sf11b2">;</span></code></td>
<td class="ln">259</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">ngx_http_upstream_srv_conf_t</span><span class="sf11b2">&nbsp; *</span><span class="sf3b2">uscf</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">260</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">260</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">261</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uscf</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">ngx_http_conf_get_module_srv_conf</span><span class="sf11b2">(</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_http_upstream_module</span><span class="sf11b2">);</span></code></td>
<td class="ln">261</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uscf</span><span class="sf11b2">&nbsp;= </span><span class="sf8b2">ngx_http_conf_get_module_srv_conf</span><span class="sf11b2">(</span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf3b2">ngx_http_upstream_module</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">262</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">262</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">263</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">uscf</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">init_upstream</span><span class="sf11b2">) {</span></code></td>
<td class="ln">263</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">if</span><span class="sf11b2">&nbsp;(</span><span class="sf3b2">uscf</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">init_upstream</span><span class="sf11b2">) {</span></code></td>
</tr>
<tr>
<td class="ln">264</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_conf_log_error</span><span class="sf11b2">(</span><span class="sf3b2">NGX_LOG_WARN</span><span class="sf11b2">, </span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
<td class="ln">264</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="sf8b2">ngx_conf_log_error</span><span class="sf11b2">(</span><span class="sf3b2">NGX_LOG_WARN</span><span class="sf11b2">, </span><span class="sf3b2">cf</span><span class="sf11b2">, </span><span class="sf10b2">0</span><span class="sf11b2">,</span></code></td>
</tr>
<tr>
<td class="ln">265</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"load balancing method redefined"</span><span class="sf11b2">);</span></code></td>
<td class="ln">265</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="sf12b2">"load balancing method redefined"</span><span class="sf11b2">);</span></code></td>
</tr>
<tr>
<td class="ln">266</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
<td class="ln">266</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; }</span></code></td>
</tr>
<tr>
<td class="ln">267</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">267</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">268</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uscf</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">init_upstream</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_init_ip_hash</span><span class="sf11b2">;</span></code></td>
<td class="ln">268</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uscf</span><span class="sf11b2">-&gt;</span><span class="sf3b2">peer</span><span class="sf11b2">.</span><span class="sf3b2">init_upstream</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">ngx_http_upstream_init_ip_hash</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">269</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">269</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">270</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uscf</span><span class="sf11b2">-&gt;</span><span class="sf3b2">flags</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">NGX_HTTP_UPSTREAM_CREATE</span></code></td>
<td class="ln">270</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf3b2">uscf</span><span class="sf11b2">-&gt;</span><span class="sf3b2">flags</span><span class="sf11b2">&nbsp;= </span><span class="sf3b2">NGX_HTTP_UPSTREAM_CREATE</span></code></td>
</tr>
<tr>
<td class="ln">271</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_WEIGHT</span></code></td>
<td class="ln">271</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_WEIGHT</span></code></td>
</tr>
<tr>
<td class="ln">272</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_MAX_CONNS</span></code></td>
<td class="ln">272</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_MAX_CONNS</span></code></td>
</tr>
<tr>
<td class="ln">273</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_MAX_FAILS</span></code></td>
<td class="ln">273</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_MAX_FAILS</span></code></td>
</tr>
<tr>
<td class="ln">274</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_FAIL_TIMEOUT</span></code></td>
<td class="ln">274</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_FAIL_TIMEOUT</span></code></td>
</tr>
<tr>
<td class="ln">275</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_DOWN</span><span class="sf11b2">;</span></code></td>
<td class="ln">275</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span><span class="sf3b2">NGX_HTTP_UPSTREAM_DOWN</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">276</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">276</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
<tr>
<td class="ln">277</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_CONF_OK</span><span class="sf11b2">;</span></code></td>
<td class="ln">277</td><td class="sf3b2"><code><span class="sf11b2">&nbsp; &nbsp; </span><span class="sf7b2">return</span><span class="sf11b2">&nbsp;</span><span class="sf3b2">NGX_CONF_OK</span><span class="sf11b2">;</span></code></td>
</tr>
<tr>
<td class="ln">278</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
<td class="ln">278</td><td class="sf3b2"><code><span class="sf11b2">}</span></code></td>
</tr>
<tr>
<td class="ln">279</td><td class="sf3b2"><code>&nbsp;</code></td>
<td class="ln">279</td><td class="sf3b2"><code>&nbsp;</code></td>
</tr>
</tbody>
</table>
</body>
</html>
